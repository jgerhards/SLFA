echo 'anonymizer=ipv4
' > testconfig.properties

cd build/classes/java/main

echo 'no ip address
1.1.172.3
123' > testfile.txt

echo 'anonymizer=ipv4

ipv4.bits=16
ipv4.mode=zero' > testconfig.properties

java -Dconfigfile=testconfig.properties com.rsyslog.slfa.Main testfile.txt > test.log

echo 'no ip address
1.1.0.0
123' | cmp test.log
if [ ! $? -eq 0 ]; then
  echo "invalid response generated, test.log is:"
  echo '====='
  cat test.log
  echo '====='
  exit 1
else
  rm testconfig.properties
  rm testfile.txt
fi;

cd ../../../..
